<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UNPLUG: The Inspection Line ‚Äî Traversal</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;500;700;900&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0f0f1a; color: #e0e0f0; font-family: 'Outfit', sans-serif; overflow: hidden; }
  #top-bar { position: fixed; top: 0; left: 0; right: 0; height: 48px; background: linear-gradient(90deg, #1a1a2e, #16213e); display: flex; align-items: center; padding: 0 24px; z-index: 10; border-bottom: 2px solid #00d9ff33; }
  #top-bar h1 { font-size: 16px; font-weight: 700; color: #00d9ff; letter-spacing: 1px; }
  #top-bar .tag { background: #a78bfa33; color: #a78bfa; font-size: 11px; padding: 2px 10px; border-radius: 20px; margin-left: 16px; font-weight: 700; }
  #code-panel { position: fixed; bottom: 0; left: 0; right: 0; height: 170px; background: #0d1117; border-top: 2px solid #00d9ff44; padding: 12px 24px; z-index: 10; font-family: 'JetBrains Mono', monospace; }
  #code-panel .label { font-size: 11px; color: #00d9ff; font-weight: 700; letter-spacing: 2px; margin-bottom: 6px; }
  #code-lines { font-size: 13px; line-height: 1.6; white-space: pre; }
  .code-dim { color: #4a4a6a; }
  .code-kw { color: #e94560; }
  .code-str { color: #4ade80; }
  .code-num { color: #ffd93d; }
  .code-fn { color: #00d9ff; }
  .code-hl { background: #00d9ff15; display: inline; padding: 0 4px; border-left: 2px solid #00d9ff; }
  .code-hl-green { background: #4ade8015; display: inline; padding: 0 4px; border-left: 2px solid #4ade80; }
  .code-hl-yellow { background: #ffd93d15; display: inline; padding: 0 4px; border-left: 2px solid #ffd93d; }
  #controls { position: fixed; top: 56px; left: 16px; background: #16213e; border: 1px solid #00d9ff33; border-radius: 8px; padding: 14px 16px; z-index: 10; min-width: 240px; }
  #controls .mode-title { color: #00d9ff; font-weight: 700; font-size: 11px; letter-spacing: 1px; margin-bottom: 8px; }
  #controls button { display: block; width: 100%; background: #0f3460; border: 1px solid #00d9ff22; color: #b0b0c0; padding: 7px 12px; border-radius: 5px; font-family: 'Outfit', sans-serif; font-size: 12px; cursor: pointer; margin-bottom: 4px; text-align: left; }
  #controls button:hover { background: #00d9ff15; color: white; }
  #controls button.active { background: #00d9ff22; border-color: #00d9ff; color: #00d9ff; font-weight: 700; }
  #controls button .key { background: #0d1117; padding: 1px 5px; border-radius: 3px; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #ffd93d; margin-right: 6px; }
  #stats { position: fixed; top: 56px; right: 16px; background: #16213e; border: 1px solid #00d9ff33; border-radius: 8px; padding: 14px 16px; font-size: 12px; z-index: 10; min-width: 180px; font-family: 'JetBrains Mono', monospace; }
  #stats .stat-label { color: #b0b0c0; font-size: 10px; letter-spacing: 1px; }
  #stats .stat-val { color: #ffd93d; font-size: 18px; font-weight: 700; }
</style>
</head>
<body>
<div id="top-bar">
  <h1>UNPLUG: THE INSPECTION LINE</h1>
  <span class="tag">TRAVERSAL</span>
</div>
<div id="controls">
  <div class="mode-title">TRAVERSAL MODE</div>
  <button id="btn1" class="active" onclick="setMode(1)"><span class="key">1</span>Read All</button>
  <button id="btn2" onclick="setMode(2)"><span class="key">2</span>Update All (+5 bonus)</button>
  <button id="btn3" onclick="setMode(3)"><span class="key">3</span>Filter (score > 80)</button>
  <button id="btn4" onclick="setMode(4)"><span class="key">4</span>Count (score > 80)</button>
  <button id="btn5" onclick="setMode(5)"><span class="key">5</span>Sum All</button>
  <button onclick="runTraversal()" style="background:#0f3460;border-color:#4ade80;color:#4ade80;margin-top:8px">‚ñ∂ Run Traversal</button>
  <button onclick="resetAll()" style="margin-top:2px">‚Üª Reset Scores</button>
</div>
<div id="stats">
  <div class="stat-label">ACCUMULATOR</div>
  <div class="stat-val" id="accumVal">‚Äî</div>
  <div id="accumLabel" style="color:#b0b0c0;font-size:10px;margin-top:4px"></div>
</div>
<div id="code-panel">
  <div class="label">LIVE CODE</div>
  <div id="code-lines"></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<script>
const N = 8;
const NAMES = ["Alice","Bob","Carol","Dave","Eve","Frank","Grace","Hank"];
const COLORS = ["#e94560","#ff9f43","#ffd93d","#4ade80","#00d9ff","#a78bfa","#f472b6","#38bdf8"];

let scores = [];
let mode = 1;
let inspectorI = -1;
let running = false;
let timer = 0;
let speed = 40;
let phase = "idle";
let accumulator = 0;
let countAcc = 0;
let peopleState = [];
let inspectorX = -80;

function setup() {
  let c = createCanvas(windowWidth, windowHeight - 170);
  c.position(0, 48);
  textAlign(CENTER, CENTER);
  resetAll();
}

function resetAll() {
  scores = [];
  for (let i = 0; i < N; i++) {
    scores.push(floor(random(55, 100)));
    if (!peopleState[i]) peopleState[i] = {};
    peopleState[i].highlight = 0;
    peopleState[i].highFive = 0;
    peopleState[i].bob = random(1000);
    peopleState[i].cardShow = 0;
    peopleState[i].updated = false;
    peopleState[i].filtered = false;
  }
  inspectorI = -1;
  running = false;
  phase = "idle";
  accumulator = 0;
  countAcc = 0;
  inspectorX = -80;
  updateCode();
  document.getElementById("accumVal").textContent = "‚Äî";
  document.getElementById("accumLabel").textContent = "";
}

function setMode(m) {
  mode = m;
  for (let i = 1; i <= 5; i++) {
    document.getElementById("btn" + i).className = (i === m) ? "active" : "";
  }
  resetTraversal();
  updateCode();
}

function resetTraversal() {
  inspectorI = -1;
  running = false;
  phase = "idle";
  accumulator = 0;
  countAcc = 0;
  inspectorX = -80;
  for (let p of peopleState) {
    p.highlight = 0; p.highFive = 0; p.cardShow = 0;
    p.updated = false; p.filtered = false;
  }
  document.getElementById("accumVal").textContent = "‚Äî";
  document.getElementById("accumLabel").textContent = "";
}

function runTraversal() {
  resetTraversal();
  running = true;
  phase = "running";
  inspectorI = 0;
  timer = 0;
  if (mode === 4) { countAcc = 0; document.getElementById("accumVal").textContent = "0"; document.getElementById("accumLabel").textContent = "count (score > 80)"; }
  if (mode === 5) { accumulator = 0; document.getElementById("accumVal").textContent = "0"; document.getElementById("accumLabel").textContent = "sum"; }
  processCurrentIndex();
  updateCode();
}

function processCurrentIndex() {
  let i = inspectorI;
  if (i < 0 || i >= N) return;
  let p = peopleState[i];
  p.highlight = 1;
  p.cardShow = 1;

  if (mode === 2) {
    scores[i] += 5;
    p.updated = true;
  } else if (mode === 3) {
    p.filtered = scores[i] > 80;
    if (p.filtered) p.highFive = 1;
  } else if (mode === 4) {
    if (scores[i] > 80) {
      countAcc++;
      p.filtered = true;
    }
    document.getElementById("accumVal").textContent = countAcc;
  } else if (mode === 5) {
    accumulator += scores[i];
    document.getElementById("accumVal").textContent = accumulator;
  }
}

function advanceTraversal() {
  if (inspectorI >= 0 && inspectorI < N) {
    peopleState[inspectorI].highlight = 0;
  }
  inspectorI++;
  if (inspectorI < N) {
    processCurrentIndex();
  } else {
    phase = "done";
    running = false;
    if (mode === 4) document.getElementById("accumLabel").textContent = `count of scores > 80 = ${countAcc}`;
    if (mode === 5) document.getElementById("accumLabel").textContent = `total sum = ${accumulator}`;
  }
  updateCode();
}

function draw() {
  background(15, 15, 26);
  let h = height;
  let floorY = h * 0.68;

  if (running) {
    timer++;
    if (timer >= speed) {
      timer = 0;
      advanceTraversal();
    }
  }

  // Floor
  stroke(40, 50, 80);
  strokeWeight(2);
  line(0, floorY, width, floorY);

  let spacing = min(110, (width - 360) / N);
  let startX = 280;

  // Target inspector position
  let targetIX = (inspectorI >= 0 && inspectorI < N) ? startX + inspectorI * spacing : (inspectorI >= N ? startX + N * spacing + 40 : startX - 80);
  inspectorX = lerp(inspectorX, targetIX, 0.08);

  // Draw people
  for (let i = 0; i < N; i++) {
    let x = startX + i * spacing;
    let p = peopleState[i];
    p.bob += 0.02;
    p.highlight = lerp(p.highlight, (i === inspectorI) ? 1 : 0, 0.1);
    p.highFive = lerp(p.highFive, 0, 0.03);
    p.cardShow = lerp(p.cardShow, (i === inspectorI) ? 1 : 0, 0.1);

    let bobY = sin(p.bob) * 2;
    let baseY = floorY + bobY;

    push();
    translate(x, baseY);

    // State-based glow
    if (p.highlight > 0.1) {
      noStroke();
      fill(0, 217, 255, p.highlight * 40);
      ellipse(0, -50, 80, 110);
    }
    if (p.filtered && mode === 3) {
      noStroke();
      fill(74, 222, 128, 30);
      ellipse(0, -50, 80, 110);
    }

    // Determine color
    let col;
    if (p.updated) col = color(74, 222, 128);
    else if (p.filtered && (mode === 3 || mode === 4)) col = color(74, 222, 128);
    else if (i === inspectorI) col = color(0, 217, 255);
    else col = color(COLORS[i]);

    // Stick figure
    stroke(col);
    strokeWeight(i === inspectorI ? 3.5 : 2.5);
    noFill();
    line(0, -65, 0, -28);
    line(0, -28, -10, 0);
    line(0, -28, 10, 0);
    // Arms - high five if filtered
    if (p.highFive > 0.1) {
      line(0, -55, -18, -75);
      line(0, -55, 18, -75);
    } else {
      line(0, -55, -15, -42);
      line(0, -55, 15, -42);
    }
    fill(15, 15, 26);
    stroke(col);
    ellipse(0, -77, 22, 22);

    // Score card above head
    let cardAlpha = max(p.cardShow, (phase === "done" ? 0.8 : 0)) * 255;
    if (cardAlpha > 20) {
      noStroke();
      fill(255, 255, 255, cardAlpha);
      rect(-20, -108, 40, 24, 5);
      fill(15, 15, 26, cardAlpha);
      textFont("JetBrains Mono");
      textSize(14);
      textStyle(BOLD);
      text(scores[i], 0, -96);
      if (p.updated) {
        fill(74, 222, 128, cardAlpha);
        textSize(10);
        text("+5", 24, -108);
      }
    }

    // Name
    noStroke();
    fill(150, 150, 180);
    textFont("Outfit");
    textSize(10);
    textStyle(NORMAL);
    text(NAMES[i], 0, 14);

    pop();

    // Floor index
    noStroke();
    fill(0, 217, 255, i === inspectorI ? 80 : 30);
    rect(x - 14, floorY + 4, 28, 22, 3);
    fill(0, 217, 255, i === inspectorI ? 255 : 100);
    textFont("JetBrains Mono");
    textSize(12);
    textStyle(BOLD);
    text(i, x, floorY + 15);
  }

  // Draw inspector (walking character with clipboard)
  let iy = floorY;
  push();
  translate(inspectorX, iy);
  // Clipboard body
  noStroke();
  fill(255, 217, 61, 40);
  ellipse(0, -80, 60, 90);
  // Inspector stick figure (different color)
  stroke(255, 217, 61);
  strokeWeight(3);
  noFill();
  line(0, -100, 0, -60);
  line(0, -60, -10, -35);
  line(0, -60, 10, -35);
  // Clipboard in hand
  line(0, -85, 18, -75);
  noStroke();
  fill(255, 217, 61, 200);
  rect(14, -82, 16, 20, 2);
  fill(15, 15, 26);
  textSize(6);
  text("üìã", 22, -72);
  // Head
  fill(15, 15, 26);
  stroke(255, 217, 61);
  strokeWeight(3);
  ellipse(0, -112, 22, 22);
  // Hat
  noStroke();
  fill(255, 217, 61);
  rect(-14, -125, 28, 5, 2);
  // Label
  noStroke();
  fill(255, 217, 61);
  textFont("Outfit");
  textSize(11);
  textStyle(BOLD);
  text("Inspector", 0, -135);
  textFont("JetBrains Mono");
  textSize(10);
  fill(255, 217, 61, 180);
  text(inspectorI >= 0 && inspectorI < N ? `i = ${inspectorI}` : (phase === "done" ? "done!" : ""), 0, -28);
  pop();

  // Array bar at top
  let barY = 58;
  noStroke();
  fill(22, 33, 62, 200);
  rect(startX - 24, barY, N * spacing + 8, 36, 6);
  for (let i = 0; i < N; i++) {
    let x = startX + i * spacing;
    let isActive = (i === inspectorI);
    fill(isActive ? color(0,217,255,60) : color(30,40,60));
    rect(x - spacing/2 + 3, barY + 3, spacing - 6, 30, 3);
    fill(isActive ? color(255,255,255) : color(150,150,180));
    textFont("JetBrains Mono");
    textSize(13);
    text(scores[i], x, barY + 18);
  }
  fill(100,100,150);
  textSize(20);
  text("[", startX - spacing/2 - 4, barY + 16);
  text("]", startX + (N-1)*spacing + spacing/2 + 4, barY + 16);
}

function updateCode() {
  let el = document.getElementById("code-lines");
  let arr = `[${scores.join(", ")}]`;
  let lines = "";
  let loopLine = `<span class="code-kw">for</span> (<span class="code-kw">let</span> i = <span class="code-num">0</span>; i < scores.length; i++)`;

  if (mode === 1) {
    if (phase === "idle") {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  console.<span class="code-fn">log</span>(scores[i]);  <span class="code-dim">// Read each score</span>
}`;
    } else if (phase === "running") {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  <span class="code-hl">console.<span class="code-fn">log</span>(scores[<span class="code-num">${inspectorI}</span>]);  <span class="code-dim">// ‚Üí ${scores[inspectorI]} (${NAMES[inspectorI]}'s score)</span></span>
}`;
    } else {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  console.<span class="code-fn">log</span>(scores[i]);
} <span class="code-str">// ‚úì Read all ${N} scores!</span>`;
    }
  } else if (mode === 2) {
    if (phase === "running") {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  <span class="code-hl-green">scores[<span class="code-num">${inspectorI}</span>] += <span class="code-num">5</span>;  <span class="code-dim">// ${scores[inspectorI]-5} + 5 = ${scores[inspectorI]} ‚úì</span></span>
}`;
    } else if (phase === "done") {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  scores[i] += <span class="code-num">5</span>;  <span class="code-dim">// Add 5 bonus points to each</span>
} <span class="code-str">// ‚úì All ${N} scores updated!</span>`;
    } else {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  scores[i] += <span class="code-num">5</span>;  <span class="code-dim">// Add 5 bonus to every score</span>
}`;
    }
  } else if (mode === 3) {
    if (phase === "running") {
      let pass = scores[inspectorI] > 80;
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  <span class="${pass ? 'code-hl-green' : 'code-hl'}"><span class="code-kw">if</span> (scores[<span class="code-num">${inspectorI}</span>] > <span class="code-num">80</span>)  <span class="code-dim">// ${scores[inspectorI]} > 80? ${pass ? "YES! üôå" : "No, skip"}</span></span>
    console.<span class="code-fn">log</span>(<span class="code-str">"High five!"</span>);
}`;
    } else {
      lines = `<span class="code-kw">let</span> <span class="code-fn">scores</span> = ${arr};
${loopLine} {
  <span class="code-kw">if</span> (scores[i] > <span class="code-num">80</span>) {  <span class="code-dim">// Only process matching elements</span>
    console.<span class="code-fn">log</span>(<span class="code-str">"High five!"</span>);
  }
}`;
    }
  } else if (mode === 4) {
    if (phase === "running") {
      let pass = scores[inspectorI] > 80;
      lines = `<span class="code-kw">let</span> count = <span class="code-num">${countAcc}</span>;  <span class="code-dim">// ‚Üê accumulator</span>
${loopLine} {
  <span class="${pass ? 'code-hl-yellow' : 'code-hl'}"><span class="code-kw">if</span> (scores[<span class="code-num">${inspectorI}</span>] > <span class="code-num">80</span>) count++;  <span class="code-dim">// ${scores[inspectorI]} > 80? ${pass ? `YES ‚Üí count = ${countAcc}` : "No"}</span></span>
}`;
    } else if (phase === "done") {
      lines = `<span class="code-kw">let</span> count = <span class="code-num">0</span>;
${loopLine} {
  <span class="code-kw">if</span> (scores[i] > <span class="code-num">80</span>) count++;
}
<span class="code-str">// ‚úì count = ${countAcc} students scored above 80</span>`;
    } else {
      lines = `<span class="code-kw">let</span> count = <span class="code-num">0</span>;  <span class="code-dim">// ‚Üê accumulator starts at 0</span>
${loopLine} {
  <span class="code-kw">if</span> (scores[i] > <span class="code-num">80</span>) count++;  <span class="code-dim">// Only count matches</span>
}`;
    }
  } else if (mode === 5) {
    if (phase === "running") {
      lines = `<span class="code-kw">let</span> sum = <span class="code-num">${accumulator}</span>;  <span class="code-dim">// ‚Üê accumulator</span>
${loopLine} {
  <span class="code-hl-yellow">sum += scores[<span class="code-num">${inspectorI}</span>];  <span class="code-dim">// + ${scores[inspectorI]} ‚Üí sum = ${accumulator}</span></span>
}`;
    } else if (phase === "done") {
      lines = `<span class="code-kw">let</span> sum = <span class="code-num">0</span>;
${loopLine} {
  sum += scores[i];
}
<span class="code-str">// ‚úì sum = ${accumulator} (average = ${(accumulator/N).toFixed(1)})</span>`;
    } else {
      lines = `<span class="code-kw">let</span> sum = <span class="code-num">0</span>;  <span class="code-dim">// ‚Üê accumulator starts at 0</span>
${loopLine} {
  sum += scores[i];  <span class="code-dim">// Add each score to the total</span>
}`;
    }
  }
  el.innerHTML = lines;
}

function keyPressed() {
  if (key >= '1' && key <= '5') setMode(int(key));
  else if (key === ' ') runTraversal();
  else if (key === 'r' || key === 'R') resetAll();
}

function windowResized() { resizeCanvas(windowWidth, windowHeight - 170); }
</script>
</body>
</html>
