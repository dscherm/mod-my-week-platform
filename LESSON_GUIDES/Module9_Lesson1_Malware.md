# Lesson 9.1: Malicious Code - Malware Types

## Lesson Overview
| Item | Details |
|------|---------|
| **Duration** | 60-75 minutes |
| **Module** | 9 - Threats & Attacks |
| **Prerequisites** | Basic security concepts |
| **Platform Features** | Challenges, Network Monitor |

## Learning Objectives
By the end of this lesson, students will be able to:
1. Define malware and explain its purpose
2. Classify major malware types (virus, worm, trojan, ransomware, etc.)
3. Identify malware delivery methods and infection vectors
4. Recognize indicators of compromise (IOCs) for different malware
5. Describe basic malware defense strategies

## Vocabulary Terms
- **Malware** - Malicious software designed to harm systems
- **Virus** - Malware that attaches to files and requires user action to spread
- **Worm** - Self-replicating malware that spreads without user action
- **Trojan** - Malware disguised as legitimate software
- **Ransomware** - Malware that encrypts data and demands payment
- **Spyware** - Malware that secretly monitors user activity
- **Rootkit** - Malware that hides deep in the system
- **Botnet** - Network of infected computers controlled remotely
- **C2 (Command & Control)** - Server that controls malware remotely

## Materials Needed
- CyberEd Range platform access
- Malware family chart
- Infection vector diagram
- IOC identification worksheet

---

## Phase 1: EXPLORE (10-15 minutes)

### Activity: "The Infection Timeline"

**Setup:** Present this story:

> "Monday 9 AM: Sarah downloads a free PDF converter from a website. The software works fine! But something else happened..."

**The Timeline (reveal piece by piece):**
```
Monday 9:00 AM - Sarah downloads "FreePDFConverter.exe"
Monday 9:01 AM - Installs successfully, converts PDFs fine
Monday 9:05 AM - Unknown program starts in background
Monday 10:00 AM - Sarah's browser has new toolbar she didn't install
Tuesday 8:00 AM - Computer is slow, fan running constantly
Tuesday 2:00 PM - IT notices unusual network traffic from Sarah's PC
Wednesday 6:00 AM - 50 other computers show same symptoms
Thursday 3:00 AM - Ransomware message appears on all 51 computers
```

**Student Discussion:**
1. What happened on Monday? _______________
2. How did it spread to other computers? _______________
3. What type(s) of malware were involved? _______________
4. At what point could this have been stopped? _______________

**Reveal:**
> "Sarah encountered a TROJAN (disguised as legitimate software) that installed SPYWARE (the toolbar), became part of a BOTNET (spreading to others), and ultimately delivered RANSOMWARE. One click led to a chain reaction of different malware types!"

---

## Phase 2: EXPLAIN (15-20 minutes)

### Part 1: What Is Malware?

**Definition:**
> Malware (malicious software) is any software intentionally designed to cause damage to a computer, server, client, or network.

**Malware Goals:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MALWARE OBJECTIVES                      â”‚
â”‚                                                          â”‚
â”‚  ðŸ’° Financial Gain       â”‚  ðŸ”“ Unauthorized Access       â”‚
â”‚  â”œâ”€â”€ Ransomware         â”‚  â”œâ”€â”€ Backdoors               â”‚
â”‚  â”œâ”€â”€ Banking trojans    â”‚  â”œâ”€â”€ RATs                    â”‚
â”‚  â””â”€â”€ Cryptominers       â”‚  â””â”€â”€ Rootkits                â”‚
â”‚                                                          â”‚
â”‚  ðŸ“Š Data Theft          â”‚  ðŸ’¥ Destruction              â”‚
â”‚  â”œâ”€â”€ Spyware            â”‚  â”œâ”€â”€ Wipers                  â”‚
â”‚  â”œâ”€â”€ Keyloggers         â”‚  â””â”€â”€ Logic bombs             â”‚
â”‚  â””â”€â”€ Info stealers      â”‚                              â”‚
â”‚                                                          â”‚
â”‚  ðŸ¤– Resource Abuse      â”‚  ðŸ“¢ Disruption               â”‚
â”‚  â”œâ”€â”€ Botnets            â”‚  â”œâ”€â”€ DDoS tools              â”‚
â”‚  â”œâ”€â”€ Spam relays        â”‚  â””â”€â”€ Adware                  â”‚
â”‚  â””â”€â”€ Cryptominers       â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Part 2: Malware Classification

#### VIRUS
**Characteristics:**
- Attaches to legitimate files/programs
- Requires user action to spread (opening file, running program)
- Cannot spread on its own

```
How Viruses Spread:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Infected â”‚â”€â”€â”€â”€â–¶â”‚ User     â”‚â”€â”€â”€â”€â–¶â”‚ New File â”‚
â”‚   File   â”‚     â”‚ Opens It â”‚     â”‚ Infected â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
               Shares file with
               friend/colleague
                      â”‚
                      â–¼
                 Virus spreads
```

**Examples:** File infectors, boot sector viruses, macro viruses

---

#### WORM
**Characteristics:**
- Self-replicating
- Spreads WITHOUT user action
- Exploits vulnerabilities to move network to network

```
How Worms Spread:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Infected â”‚â”€â”€â”€â”€ Network â”€â”€â”€â”€â”€â”€â–¶â”‚ Computer â”‚
â”‚ Computer â”‚     Vulnerability  â”‚ 2        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                â–¼                â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Computer â”‚    â”‚ Computer â”‚    â”‚ Computer â”‚
              â”‚ 3        â”‚    â”‚ 4        â”‚    â”‚ 5        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Spreads exponentially without any user clicks!
```

**Famous Examples:**
- WannaCry (2017) - EternalBlue exploit
- Code Red (2001) - Web server vulnerability
- Conficker (2008) - Windows vulnerability

---

#### TROJAN
**Characteristics:**
- Disguised as legitimate software
- Does NOT self-replicate
- User must download/install it
- Named after the Trojan Horse

```
Trojan Deception:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     "Free Video Player.exe"         â”‚
â”‚                                     â”‚
â”‚    What you see:  ðŸŽ¬ Video Player   â”‚
â”‚    What's hidden: ðŸ¦  Malware        â”‚
â”‚                                     â”‚
â”‚    User thinks: "Cool, free stuff!" â”‚
â”‚    Reality: Backdoor installed      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Common Trojan Types:**
| Type | Purpose |
|------|---------|
| Backdoor Trojan | Creates secret access point |
| Banking Trojan | Steals financial credentials |
| RAT (Remote Access Trojan) | Full remote control |
| Downloader | Downloads additional malware |

---

#### RANSOMWARE
**Characteristics:**
- Encrypts victim's files
- Demands payment (usually cryptocurrency) for decryption key
- May threaten to leak data ("double extortion")

```
Ransomware Attack Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deliveryâ”‚â”€â”€â”€â–¶â”‚ Executionâ”‚â”€â”€â”€â–¶â”‚ Encryption â”‚â”€â”€â”€â–¶â”‚ Ransom   â”‚
â”‚ (email, â”‚    â”‚ (payload â”‚    â”‚ (files     â”‚    â”‚ Note     â”‚
â”‚ exploit)â”‚    â”‚  runs)   â”‚    â”‚  locked)   â”‚    â”‚ Displayedâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Typical Ransom Note:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR FILES HAVE BEEN ENCRYPTED!                â”‚
â”‚                                                  â”‚
â”‚  All your documents, photos, and databases      â”‚
â”‚  are now encrypted with military-grade          â”‚
â”‚  encryption.                                     â”‚
â”‚                                                  â”‚
â”‚  To decrypt: Send 0.5 Bitcoin to:               â”‚
â”‚  [Bitcoin address]                               â”‚
â”‚                                                  â”‚
â”‚  You have 72 hours before price doubles.        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Notable Ransomware:**
- WannaCry (2017) - Global attack, $4B+ damage
- NotPetya (2017) - Destructive, disguised as ransomware
- REvil (2021) - Major supply chain attacks
- LockBit (2022-present) - Ransomware-as-a-Service

---

#### SPYWARE
**Characteristics:**
- Secretly monitors user activity
- Collects data without consent
- Often bundled with "free" software

**Types:**
| Type | What It Captures |
|------|------------------|
| Keylogger | Every keystroke |
| Screen capture | Screenshots/video |
| Browser tracker | Web history, cookies |
| Credential stealer | Passwords, logins |

---

#### ROOTKIT
**Characteristics:**
- Hides deep in operating system
- Very difficult to detect
- Often survives reboots and reinstalls
- Can hide other malware

```
Rootkit Hiding:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          OPERATING SYSTEM          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        ROOTKIT               â”‚  â”‚ â† Intercepts system calls
â”‚  â”‚  (invisible to user and AV)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                      â”‚
â”‚              â–¼                      â”‚
â”‚  Hides: Files, processes, network  â”‚
â”‚         connections, other malware â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### BOTNET
**Characteristics:**
- Network of infected computers ("zombies")
- Controlled by attacker via C2 server
- Used for DDoS, spam, cryptomining

```
Botnet Structure:
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Attacker  â”‚
                    â”‚ (Botmaster) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚  C2 Server  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Zombie 1â”‚       â”‚ Zombie 2â”‚       â”‚ Zombie 3â”‚
    â”‚   ðŸ–¥ï¸    â”‚       â”‚   ðŸ–¥ï¸    â”‚       â”‚   ðŸ–¥ï¸    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ... thousands or millions of bots ...
```

### Part 3: Delivery Methods

| Method | Description | Example |
|--------|-------------|---------|
| **Phishing** | Malicious email attachments/links | "Invoice.pdf.exe" |
| **Drive-by Download** | Visiting compromised website | Exploit kit on hacked site |
| **Malvertising** | Malicious ads on legitimate sites | Infected ad network |
| **USB Drop** | Infected removable media | Parking lot USB drives |
| **Software Bundling** | Hidden in "free" downloads | Adware with free software |
| **Supply Chain** | Compromised legitimate software | SolarWinds attack |
| **Exploit Kits** | Automated vulnerability exploitation | Angler, RIG |

### Part 4: Indicators of Compromise (IOCs)

**System IOCs:**
- Unexpected processes running
- High CPU/memory usage
- Disabled security software
- New startup programs
- Changed file extensions (.encrypted)

**Network IOCs:**
- Connections to known malicious IPs
- Unusual outbound traffic
- DNS requests to suspicious domains
- Traffic at unusual hours

**User IOCs:**
- Slow computer performance
- Pop-ups or unwanted ads
- Browser redirects
- Files missing or encrypted

---

## Phase 3: APPLY (15-20 minutes)

### Guided Practice: "Malware Identifier"

**Activity 1: Classification Exercise**

Identify the malware type:

| Behavior | Malware Type |
|----------|--------------|
| Spreads through network without user action | |
| Disguised as free game download | |
| Encrypts all files, demands Bitcoin | |
| Records every keystroke | |
| Hides other malware from antivirus | |
| Attaches to Word documents | |
| Part of network sending spam | |

**Answers:** Worm, Trojan, Ransomware, Spyware/Keylogger, Rootkit, Virus, Botnet

**Activity 2: Network Monitor - Malware Detection**

Open CyberEd Range Network Monitor:
1. Run "Data Exfiltration" scenario
2. Observe traffic patterns
3. This simulates malware sending data out

**Questions:**
- What IOCs do you observe? _______________
- How would you identify the infected system? _______________
- What type of malware behavior is this? _______________

**Activity 3: Infection Chain Analysis**

Map this attack chain to malware types:

```
Email received â†’ Attachment opened â†’ Software installed â†’
Keystrokes captured â†’ Credentials stolen â†’ Lateral movement â†’
Files encrypted â†’ Ransom demanded
```

| Stage | Malware Type/Technique |
|-------|------------------------|
| Delivery | |
| Initial infection | |
| Data collection | |
| Credential theft | |
| Spreading | |
| Final payload | |

---

## Phase 4: PRACTICE (15-20 minutes)

### Independent Challenge: "Malware Analyst"

**Challenge 1: Malware Family Tree**

Create a classification chart:

```
MALWARE
â”œâ”€â”€ Self-replicating
â”‚   â”œâ”€â”€ Requires user action: _______
â”‚   â””â”€â”€ Spreads automatically: _______
â””â”€â”€ Non-replicating
    â”œâ”€â”€ Disguised as legitimate: _______
    â”œâ”€â”€ Hides in system: _______
    â””â”€â”€ Monitors activity: _______
```

**Challenge 2: IOC Matching**

Match the IOC to most likely malware:

| IOC | Likely Malware |
|-----|----------------|
| Files renamed to .encrypted | |
| Constant outbound connections to single IP | |
| Unknown process using 100% CPU | |
| AV disabled, can't be re-enabled | |
| Browser redirects to ad sites | |

**Challenge 3: Defense Planning**

For each malware type, identify ONE key defense:

| Malware | Key Defense |
|---------|-------------|
| Virus | |
| Worm | |
| Trojan | |
| Ransomware | |
| Spyware | |

**Challenge 4: Complete Related Challenges**

In CyberEd Range:
- Complete Network Monitor scenarios (detect malware traffic)
- Social Engineering challenges (malware delivery prevention)

---

## Phase 5: CHALLENGE (10-15 minutes)

### CTF Challenge: "The Malware Museum"

**Level 1 (10 points): Quick ID**

What type of malware:
- Needs you to click something to spread? _______
- Spreads on its own through network vulnerabilities? _______
- Locks your files until you pay? _______

**Level 2 (15 points): Attack Analysis**

An employee reports:
- Downloaded "free resume template"
- Computer is slow
- IT finds connections to unknown IP every 5 minutes
- Same behavior now on 3 other computers

Questions:
1. What was the initial infection type? _______
2. What is the malware now doing (C2 connections)? _______
3. How did it spread to other computers? _______
4. What type of network is this becoming? _______

**Level 3 (20 points): Incident Reconstruction**

Timeline:
```
Day 1: User receives email with "Important.doc" attachment
Day 1: Macro runs when document opened
Day 2: Cobalt Strike beacon detected
Day 5: Multiple systems compromised
Day 7: 500GB uploaded to external server
Day 8: All file servers encrypted, ransom note displayed
```

For each day, identify:
- Malware type/technique used
- What stage of attack
- What could have stopped it

**Level 4 (25 points): Defense Architecture**

Design a multi-layer defense against ransomware:

| Layer | Defense | How It Helps |
|-------|---------|--------------|
| Email | | |
| Endpoint | | |
| Network | | |
| Backup | | |
| User | | |

**BONUS (30 points): Research**

Research the NotPetya attack (2017):
1. What did it pretend to be? _______
2. What was its actual purpose? _______
3. How did it spread? _______
4. Total estimated damages? _______
5. Why couldn't victims recover even if they paid? _______

---

## Wrap-Up & Reflection (5 minutes)

### Key Takeaways
1. **Virus** = needs user action to spread
2. **Worm** = spreads automatically via vulnerabilities
3. **Trojan** = disguised as legitimate software
4. **Ransomware** = encrypts data, demands payment
5. **Defense in depth** = multiple layers of protection
6. **Backups** are your last line of defense against ransomware

### Malware Quick Reference
```
Self-spreading: Worm (auto), Virus (user action)
Deceptive: Trojan (disguised)
Destructive: Ransomware, Wiper
Stealthy: Rootkit, Spyware
Controlled: Botnet (zombie network)
```

### Exit Ticket
1. You find a USB drive in the parking lot. What type of attack might this be?
2. A computer is slow and sending traffic to an unknown IP. What might be happening?
3. What's the BEST defense against ransomware (hint: it's not paying)?

### Preview Next Lesson
> "Now you understand malware types. But attacks are evolving - next, we'll explore AI-powered threats and how artificial intelligence is changing the cybersecurity landscape!"

---

## Differentiation

### For Struggling Students
- Focus on Virus vs Worm vs Trojan distinction
- Use biological virus analogy
- Provide malware type reference card
- Work in pairs for classification exercises

### For Advanced Students
- Research malware analysis techniques
- Explore reverse engineering basics
- Investigate APT (Advanced Persistent Threat) groups
- Study kill chain and MITRE ATT&CK framework

---

## Assessment Rubric

| Criterion | Excellent (4) | Good (3) | Developing (2) | Beginning (1) |
|-----------|---------------|----------|----------------|---------------|
| Classification | Correctly identifies all types | Minor confusion | Some correct | Cannot classify |
| IOC Recognition | Identifies all indicators | Most indicators | Some indicators | Cannot identify |
| Defense Matching | Appropriate defenses for each | Mostly appropriate | Some appropriate | Cannot match |
| Attack Analysis | Reconstructs attack chain accurately | Mostly accurate | Partial understanding | Cannot analyze |

---

## Teacher Notes

### Safety Considerations
- NEVER have students interact with actual malware
- Use simulations and case studies only
- Emphasize legal and ethical boundaries
- Report any actual malware discoveries to IT

### Famous Malware for Discussion
- **ILOVEYOU (2000)**: Email worm, $10B damage
- **Stuxnet (2010)**: Nation-state worm targeting Iran
- **WannaCry (2017)**: Global ransomware pandemic
- **SolarWinds (2020)**: Supply chain attack
- **Colonial Pipeline (2021)**: Ransomware on critical infrastructure

### Real-World Statistics
- New malware: 560,000+ samples detected daily
- Ransomware attack every 11 seconds
- Average ransomware payment: $200,000+
- 94% of malware delivered via email
